#!/bin/bash

function install_docker() {
    if ! command -v docker &> /dev/null; then
        echo "Installing Docker ..."
        curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
        sudo add-apt-repository \
        "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
        $(lsb_release -cs) \
        stable"
        sudo apt-get update
        sudo apt-get install -y docker-ce bridge-utils docker-ce-cli containerd.io
    fi
    sudo usermod -aG docker $USER
    echo "'$USER' was added to the docker group. Please log out and back in for change to take effect"
}

function install_base() {
    # Install base packages
    sudo apt-get update
    sudo apt-get install -y \
        apt-transport-https \
        software-properties-common \
        ca-certificates \
        curl \
        make \
        wget \
        unzip \
        gnupg-agent \
        build-essential
}

function install_brew() {
    if ! command -v brew &> /dev/null; then
        CI=1 /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    fi
}


function install_python() {
    export PYENV_ROOT="$HOME/.pyenv"
    export PATH="$PYENV_ROOT/bin:$PATH"
    eval "$(pyenv init --path)"
    eval "$(pyenv init -)"
    eval "$(pyenv virtualenv-init -)"
    : "${PYTHON_VERSION:="3.10.2"}"
    pyenv install $PYTHON_VERSION
    pyenv global $PYTHON_VERSION
}

function install_stuff() {
    install_base
    install_docker
    install_brew
    brew install \
        z jq yq fd bat exa fzf ripgrep git-delta \
        just neovim neofetch starship pipes-sh \
        rust go@1.18 pyenv pyenv-virtualenv \
        azure-cli make yamllint shellcheck \
        kind kubectx kubernetes-cli@1.22 \
        clusterctl kustomize kubebuilder \
        gcc@5
    
    $(brew --prefix)/opt/fzf/install --all
}
